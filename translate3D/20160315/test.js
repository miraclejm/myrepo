/*http://perf.alimf.com/  @Tancy*/
!function(){"use strict";var a,b,c,d,e,f,g,h,i,j="body {overflow: hidden; background: #ebe7e4; font:normal 12px/18px sans-serif; color:#333;margin: 0} * {box-sizing:border-box;} svg {font:normal 12px/18px sans-serif;} ul,li{list-style: none;} #perfbook-holder {overflow: hidden; width:100%; padding:0;} #perfbook-content {position:relative;padding: 0 5px;} .perfbook-close {position:absolute; top:0; right:0; padding:1em; z-index:1; background:transparent; border:0; cursor:pointer;} .full-width {width:100%;} h1 {font:bold 18px/18px sans-serif; margin:1em 0; color:#666;border-bottom: 1px solid #999; padding-bottom: 10px} .text-right {text-align: right;} .text-left {text-align: left;} .title{ font-size: 30px; line-height: 50px; text-shadow: 0 0 3px rgba(0, 0, 0, 0.08); font-family: \"FreightSans Book\"; text-align: center; width: 100%; display: inline-block; height: 100px; background: url(https://gtms02.alicdn.com/tps/i2/TB1zVlIHXXXXXaDXXXXqxFJVFXX-100-100.png) no-repeat; background-position: center; background-size: 100px 100px; margin-bottom: 10px; } .tiles-holder {margin: 0 -18px 1em 0; display: -webkit-box; display: -moz-box; display: -ms-flexbox; display: -webkit-flex; display: flex; -webkit-flex-flow: row wrap; flex-flow: row wrap; } .summary-tile { flex-grow: 1; width:250px; background:#fff; padding: 1em; margin:0 18px 1em 0; color:#666; text-align:center; box-shadow: rgba(0, 0, 0, 0.2) 0px 0px 1px 0px; border: 1px solid #dbdbdb; border-radius: 5px; } .summary-tile dt {font-weight:bold; font-size:16px; display:block; line-height:1.2em; min-height:2.9em; padding:0 0 0.5em;} .summary-tile dd {font-weight:bold; line-height:60px; margin:0;} .summary-tile-appendix {float:left; clear:both; width:100%; font-size:12px; line-height:1.1em; color:#666;} .summary-tile-appendix dt {float:left; clear:both;font-weight: bold;} .summary-tile-appendix dd {float:left; margin:0 0 0 1em;} .pie-charts-holder {margin: 0 -72px 0 0; display: -webkit-box; display: -moz-box; display: -ms-flexbox; display: -webkit-flex; display: flex; -webkit-flex-flow: row wrap; flex-flow: row wrap;} .pie-chart-holder {flex-grow: 1; width:400px; max-width: 600px; margin: 20px 72px 0 0;} .pie-chart-holder h1 {min-height:2em;border-bottom: 1px solid #999; padding-bottom: 10px} .pie-chart {width:100%;} .table-holder {overflow-x:auto} .table-holder table {float:left; width:100%; font-size:12px; line-height:18px;border: 1px solid #46589a;background: #fff;} .table-holder th { padding:0 0.5em 0 2px;background: #8BCBEF;} .table-holder td {padding:0 0.5em 0 2px;border-bottom: 1px solid #5C72A5;} .table-holder tr:first-child td{border-top: 1px solid #46589a;} .table-holder tr:last-child td{border-bottom: none;} .water-fall-holder {margin: 25px 0; fill:#fff;} .water-fall-chart {width:100%; background:#fff;border: 1px solid #46589a; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAIAAACRXR/mAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NTc3MiwgMjAxNC8wMS8xMy0xOTo0NDowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6RDMyNUI3Nzk4RDk3MTFFNEIzNUI4QTYwMzhEMkQ3MzkiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6RDMyNUI3N0E4RDk3MTFFNEIzNUI4QTYwMzhEMkQ3MzkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpEMzI1Qjc3NzhEOTcxMUU0QjM1QjhBNjAzOEQyRDczOSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpEMzI1Qjc3ODhEOTcxMUU0QjM1QjhBNjAzOEQyRDczOSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PpNEVQkAAABESURBVHja7NCxEQAwCMQwyP4LfwVjhEKeQOdOUvd6dTIsLCwsLCwsLCwsLCysT/XMuIWFhYWFhYWFhYWFhYV1nLUCDADs4QZLRNh2mgAAAABJRU5ErkJggg==');} .water-fall-chart .marker-holder {width:100%;} .water-fall-chart .line-holder {stroke-width:1; stroke: #aac;} .water-fall-chart .line-holder.active {stroke: #009; stroke-width:2;} .water-fall-chart .labels {width:100%;} .water-fall-chart .labels .inner-label {pointer-events: none;} .water-fall-chart .time-block.active {opacity: 0.8;} .water-fall-chart .line-end, .water-fall-chart .line-start {display: none; stroke-width:1; stroke-opacity:0.5; stroke: #000;} .water-fall-chart .line-end.active, .water-fall-chart .line-start.active {display: block;} .time-scale line {stroke:#5d59ff; stroke-width:1;} .time-scale text {font-weight:bold;} .navigation-timing {} .resource-timing .chart-holder {} footer#bottom { height: 110px; background: #46589a; position: relative; } #bottom a.logo { width: 32px; height: 32px; background-image: url(https://gtms04.alicdn.com/tps/i4/TB1MAXFHXXXXXXJXpXX1ElnIXXX-64-64.png); background-position: 0 0; position: absolute; top: 22px; left: 50%; margin: 0px 0 0 -16px; background-size: 32px 32px; border-radius: 5px; } #bottom nav { display: block; position: absolute; top: 75px; left: 0; right: 0; text-align: center; } #bottom nav ul { margin: 0; padding: 0; text-align: center; } #bottom nav li { margin: 0; padding: 0; font-size: 14px; line-height: 18px; color: #fff; } #bottom nav li a { text-decoration: none; color: #fff; } #bottom nav li.vip, #bottom nav li.vip a { font-size: 12px; color: #7481AE; }",k=[];if(window.performance&&void 0!==window.performance.getEntriesByType)a=window.performance.getEntriesByType("resource"),c=window.performance.getEntriesByType("mark"),d=window.performance.getEntriesByType("measure");else{if(!window.performance||void 0===window.performance.webkitGetEntriesByType)return void alert("鍟婂摝, 鐪嬫潵浣犵殑娴忚涓嶆敮鎸� Resource Timing API\n鍘讳互涓嬬綉绔欐煡鐪嬮偅浜涙祻瑙堝櫒鏀寔 http://caniuse.com/#feat=resource-timing \n\n");a=window.performance.webkitGetEntriesByType("resource"),c=window.performance.webkitGetEntriesByType("mark"),d=window.performance.webkitGetEntriesByType("measure")}if(!window.performance.timing)return void alert("鍟婂摝, 鐪嬫潵浣犵殑娴忚涓嶆敮鎸� Performance timing銆�");if(e=window.performance.timing,e.loadEventEnd-e.navigationStart<0)return void alert("椤甸潰璨屼技杩樻病鍔犺浇瀹屾垚锛岃鍦ㄩ〉闈㈠姞杞藉畬鎴愬悗閲嶈瘯銆�");b=a.filter(function(a){return!a.name.match(/http[s]?\:\/\/nurun.github.io\/performance-bookmarklet\/.*/)}).map(function(a){var b,c,d,e=0===a.name.indexOf("http");e?(b=a.name.match(/:\/\/(.[^/]+)([^?]*)\??(.*)/),c=b[2].split("/").pop(),d=c.substr((Math.max(0,c.lastIndexOf("."))||1/0)+1)):(b=["",location.host],d=a.name.split(":")[0]);var f={name:a.name,domain:b[1],initiatorType:a.initiatorType||d||"SourceMap or Not Defined",fileExtension:d||"XHR or Not Defined",loadtime:a.duration,isRequestToHost:b[1]===location.host};for(var g in a)"function"!=typeof a[g]&&(f[g]=a[g]);return a.requestStart&&(f.requestStartDelay=a.requestStart-a.startTime,f.dns=a.domainLookupEnd-a.domainLookupStart,f.tcp=a.connectEnd-a.connectStart,f.ttfb=a.responseStart-a.startTime,f.requestDuration=a.responseStart-a.requestStart),a.secureConnectionStart&&(f.ssl=a.connectEnd-a.secureConnectionStart),f}),k.push({name:"All loaded resources",data:b,columns:["name","domain","initiatorType","fileExtension","loadtime","isRequestToHost","requestStartDelay","dns","tcp","ttfb","requestDuration","ssl"]});var l=function(a,b,c){b=b||{};var d=document.createElement(a);for(var e in b)"text"!=e&&(d[e]=b[e]);return b.text?d.textContent=b.text:b.html&&(d.innerHTML=b.html),b["class"]&&(d.className=b["class"]),b.cellspacing&&(d.cellSpacing=b.cellspacing),d.style.cssText=c||"",d},m=function(a,b,c){var d=document.createElementNS("http://www.w3.org/2000/svg",a);b=b||{};for(var e in b)"text"!=e&&d.setAttributeNS(null,e,b[e]);return d.textContent=b.text||"",d.style.cssText=c||"",d},n=function(a,b,c){return m("text",{fill:"#111",y:b,text:a},(c||"")+" text-shadow:0 0 4px #fff;")},o=function(a){var b=m("svg:svg",{},"visibility:hidden;");b.appendChild(a),g.body.appendChild(b);var c=a.getBBox().width;return b.parentNode.removeChild(b),c},p=function(a,b,c){for(var d=[a||"0123456789ABCDEF",b||"0123456789ABCDEF",c||"0123456789ABCDEF"],e="#",f=0,g=0;6>g;g++)f=Math.floor(g/2),e+=d[f].split("")[Math.floor(Math.random()*d[f].length)];return e},q=function(a,b){return-1!==a.indexOf(b,a.length-b.length)},r=function(a,b){var c=b||"#d6d6d7";switch(a){case"css":c="#c5efaf";break;case"iframe":c="#85b3f2";break;case"img":c="#c98dfd";break;case"script":c="#feb06a";break;case"link":c="#6c7385";break;case"xmlhttprequest":c="#efef70"}return c},s=function(a,b){var c,d={},e=[];a.forEach(function(a){d[a]=d[a]?d[a]+1:1});for(var f in d)c={},c[b||"key"]=f,c.count=d[f],e.push(c);return e.sort(function(a,b){return a.count<b.count?1:-1})},t=function(a,b){var c;document.createEvent?(c=document.createEvent("HTMLEvents"),c.initEvent(b,!0,!0)):(c=document.createEventObject(),c.eventType=b),c.eventName=b,document.createEvent?a.dispatchEvent(c):a.fireEvent("on"+c.eventType,c)},u=function(a,b){return a.classList?a.classList.add(b):a.setAttribute("class",a.getAttribute("class")+" "+b),a},v=function(a,b){return a.classList?a.classList.remove(b):a.setAttribute("class",a.getAttribute("class").replace(new RegExp("(\\s|^)"+b+"(\\s|$)","g"),"$2")),a},w=function(){var a=!1,b=[],c=function(){a=!0,window.removeEventListener("iFrameLoaded",c,!1),b.forEach(function(a){a()})};return window.addEventListener("iFrameLoaded",c,!1),function(c){a?c():b.push(c)}}();f=document.getElementById("perfbook-iframe"),f?(g=f.contentWindow.document,h=g.getElementById("perfbook-holder"),t(window,"iFrameLoaded")):(f=l("iframe",{id:"perfbook-iframe",onload:function(){g=f.contentWindow.document,g.head.appendChild(l("style",{type:"text/css",html:j})),t(window,"iFrameLoaded")}},"position:absolute; top:1%; right:1%; margin-bottom:1em; left:1%; z-index: 9999; width:98%; z-index: 9999; border:0; box-shadow:0 0 25px 0 rgba(0,0,0,0.5); background:#fff;"),document.body.appendChild(f)),w(function(){if(h)for(i=g.getElementById("perfbook-content");i.firstChild;)i.removeChild(i.firstChild);else{h=l("div",{id:"perfbook-holder"}),i=l("div",{id:"perfbook-content"});var a=l("button",{"class":"perfbook-close",text:"Close"});a.addEventListener("click",function(){f.parentNode.removeChild(f)}),h.appendChild(a),h.appendChild(i),h.appendChild(l("footer",{id:"bottom",html:'<a href="/" class="sprite logo"></a> <nav class="aux"> <li>AliMF 漏 2015</li><li class="vip">Powered by <a href="http://alimf.com/" rel="generator nofollow" class="powered-by-wpcom">AliMF.com</a></li></nav>'}))}}),w(function(){var a=b.filter(function(a){return 0===a.name.indexOf("http")&&!a.name.match(/js.map$/)}),c=s(a.map(function(a){return a.domain}),"domain"),d=a.filter(function(a){return a.domain.split(".").slice(-2).join(".")===location.host.split(".").slice(-2).join(".")}).length,f=(a.filter(function(a){return!q(a.domain,document.domain)}).length,a.filter(function(a){return a.domain===location.host}).length),g=c.filter(function(a){return q(a.domain,location.host.split(".").slice(-2).join("."))&&a.domain!==location.host}).length,h=b.filter(function(a){return a.name!==location.href}).sort(function(a,b){return b.duration-a.duration}),j=Math.floor(h.reduceRight(function(a,b){return"number"!=typeof a?a.duration+b.duration:a+b.duration})/h.length),k=function(a,b,c){c=c||60;var d=l("dl",{"class":"summary-tile"});return d.appendChild(l("dt",{html:a})),d.appendChild(l("dd",{html:b},"font-size:"+c+"px;")),d},m=function(a,b,c){a.appendChild(l("dt",{html:b})),a.appendChild(l("dd",{html:c}))},n=l("div",{"class":"tiles-holder"});n.appendChild(k("Total",e.loadEventEnd-e.navigationStart+"ms",40)),n.appendChild(k("Time to First Byte",e.responseStart-e.navigationStart+"ms",40)),n.appendChild(k('<span title="domLoading to domContentLoadedEventStart">DOM Content Loading</span>',e.domContentLoadedEventStart-e.domLoading+"ms",40)),n.appendChild(k('<span title="domLoading to loadEventStart">DOM Processing</span>',e.domComplete-e.domLoading+"ms",40)),n.appendChild(k("Requests",a.length||"0")),n.appendChild(k("Domains",c.length||"0")),n.appendChild(k('Subdomains of <abbr title="Top Level Domain">TLD</abbr>',g||"0")),n.appendChild(k('Requests to <span title="'+location.host+'">Host</span>',f||"0")),n.appendChild(k('<abbr title="Top Level Domain">TLD</abbr> & Subdomain Requests',d||"0")),n.appendChild(k('<span title="'+h[0].name+'">Slowest Call</span>','<span title="'+h[0].name+'">'+Math.floor(h[0].duration)+"ms</span>",40)),n.appendChild(k("Average Call",j+"ms",40));var o=l("dl",{"class":"summary-tile-appendix"});m(o,'<abbr title="Top Level Domain">TLD</abbr>:',location.host.split(".").slice(-2).join(".")),m(o,"Host:",location.host),m(o,"document.domain:",document.domain),n.appendChild(o),i.appendChild(l("div",{"class":"title",html:""})),i.appendChild(n)}),w(function(){var a={pageLoadTime:e.loadEventEnd-e.navigationStart,output:[]},b=e.navigationStart;for(var f in e)e[f]&&"number"==typeof e[f]&&(a[f]=e[f]-b,a.output.push({name:f,"time (ms)":e[f]-b}));a.output.sort(function(a,b){return(a["time (ms)"]||0)-(b["time (ms)"]||0)});var g=function(a,b,c,d){return{name:a,start:b,end:c,total:"number"!=typeof b||"number"!=typeof c?void 0:c-b,colour:d}};a.blocks=[g("total",0,a.pageLoadTime,"#8BCBEF"),g("ttfb",a.navigationStart,a.responseStart,"#a8f698"),g("unload",a.unloadEventStart,a.unloadEventEnd,"#909"),g("redirect",a.redirectStart,a.redirectEnd,"#009"),g("App cache",a.fetchStart,a.domainLookupStart,"#099"),g("DNS",a.domainLookupStart,a.domainLookupEnd,"#a8f5f6"),g("TCP",a.connectStart,a.connectEnd,"#f3cd9d"),g("Request",a.requestStart,a.responseStart,"#a8f698"),g("Response",a.responseStart,a.responseEnd,"#6c0"),g("DOM Processing",a.domLoading,a.domComplete,"#7f7cff"),g("domContentLoaded Event",a.domContentLoadedEventStart,a.domContentLoadedEventEnd,"#a5cbf9"),g("Onload Event",a.loadEventStart,a.loadEventEnd,"#fb817e")],a.secureConnectionStart&&a.blocks.push(g("SSL",a.connectStart,a.secureConnectionStart,"#990")),a.msFirstPaint&&a.blocks.push(g("msFirstPaint Event",a.msFirstPaint,a.msFirstPaint,"#c33")),a.domInteractive&&a.blocks.push(g("domInteractive Event",a.domInteractive,a.domInteractive,"#c33")),d.forEach(function(b){a.blocks.push(g("measure:"+b.name,Math.round(b.startTime),Math.round(b.startTime+b.duration),"#f00"))});var h=function(){var b=a.pageLoadTime/100,d=a.blocks.filter(function(a){return"number"==typeof a.start&&"number"==typeof a.total}).sort(function(a,b){return(a.start||0)-(b.start||0)}),e=c.length>0?c.reduce(function(a,b){return Math.max("number"==typeof a?a:0,o(n(b.name,"0")))}):0,f=25*(d.length+1),g=f+e+35,h=l("div",{"class":"navigation-timing water-fall-holder chart-holder"}),j=m("svg:svg",{height:Math.floor(g),"class":"water-fall-chart"}),k=m("g",{"class":"labels"}),p=m("line",{x1:"0",y1:"0",x2:"0",y2:f,"class":"line-end"}),q=m("line",{x1:"0",y1:"0",x2:"0",y2:f,"class":"line-start"}),r=function(a){var b=a.target;u(b,"active");var c=b.x.baseVal.valueInSpecifiedUnits+b.width.baseVal.valueInSpecifiedUnits+"%",d=b.x.baseVal.valueInSpecifiedUnits+"%";p.x1.baseVal.valueAsString=c,p.x2.baseVal.valueAsString=c,q.x1.baseVal.valueAsString=d,q.x2.baseVal.valueAsString=d,u(p,"active"),u(q,"active"),b.parentNode.appendChild(p),b.parentNode.appendChild(q)},s=function(a){v(a.target,"active"),v(p,"active"),v(q,"active")},t=function(a,c,d,e,f,g){var h=m("rect",{width:a/b+"%",height:c,x:d/b+"%",y:e,fill:f,"class":"time-block"});return g&&h.appendChild(m("title",{text:g})),h.addEventListener("mouseover",r),h.addEventListener("mouseout",s),h},w=function(){for(var b=m("g",{"class":"time-scale full-width"}),c=0,d=a.pageLoadTime/1e3,e=100/d;d>=c;c++){var g=n(c+"sec",f);c>d-.2?(g.setAttribute("x",e*c-.5+"%"),g.setAttribute("text-anchor","end")):g.setAttribute("x",e*c+.5+"%");var h=m("line",{x1:e*c+"%",y1:"0",x2:e*c+"%",y2:f});b.appendChild(h),b.appendChild(g)}return b},x=function(){var a=m("g",{transform:"scale(1, 1)","class":"marker-holder"});return c.forEach(function(d,e){var g=m("g",{"class":"mark-holder"}),h=m("g",{"class":"line-holder"}),i=d.startTime/b;d.x=i;var j=n(d.name,f+25);j.setAttribute("writing-mode","tb"),j.setAttribute("x",i+"%"),j.setAttribute("stroke",""),h.appendChild(m("line",{x1:i+"%",y1:"0px",x2:i+"%",y2:f})),c[e-1]&&d.x-c[e-1].x<1&&(j.setAttribute("x",c[e-1].x+1+"%"),d.x=c[e-1].x+1),h.appendChild(m("line",{x1:i+"%",y1:f,x2:d.x+"%",y2:f+23})),g.addEventListener("mouseover",function(){u(h,"active"),g.parentNode.appendChild(g)}),g.addEventListener("mouseout",function(){v(h,"active")}),g.appendChild(m("title",{text:d.name+" ("+Math.round(d.startTime)+"ms)"})),g.appendChild(h),g.appendChild(j),a.appendChild(g)}),a};j.appendChild(w()),j.appendChild(x()),d.forEach(function(a,c){var d=a.total||1,e=25*c;j.appendChild(t(d,25,a.start||.001,e,a.colour,a.name+" ("+a.start+"ms - "+a.end+"ms | total: "+a.total+"ms)"));var f=n(a.name+" ("+a.total+"ms)",e+18);(a.total||1)/b>10?(f.setAttribute("class","inner-label"),f.setAttribute("x",(a.start||.001)/b+.5+"%"),f.setAttribute("width",d/b+"%")):(a.start||.001)/b+d/b<80?f.setAttribute("x",(a.start||.001)/b+d/b+.5+"%"):(f.setAttribute("x",(a.start||.001)/b-.5+"%"),f.setAttribute("text-anchor","end")),k.appendChild(f)}),j.appendChild(k),h.appendChild(l("h1",{text:"Navigation Timing"})),h.appendChild(j),i.appendChild(h)};h(),k=k.concat([{name:"Navigation Timeline",data:a.blocks,columns:["name","start","end","total"]},{name:"Navigation Events",data:a.output},{name:"Marks",data:c,columns:["name","startTime","duration"]}])}),w(function(){function a(a,b){var c=m("svg:svg",{viewBox:"0 0 "+b+" "+b,"class":"pie-chart"},"max-height:"+(.98*window.innerWidth-64)/3+"px;"),d=2*Math.PI/100,e=0,f=function(a,b,c,f,h){var i=b/2,j=e+(c*d-.001),k=e+(c/2*d-.001),l=i+i*Math.sin(e),p=i-i*Math.cos(e),q=i+i*Math.sin(j),r=i-i*Math.cos(j),s=i+.85*i*Math.sin(k),t=i-.85*i*Math.cos(k),u=j-e>Math.PI?1:0,v="M "+i+","+i+" L "+l+","+p+" A "+i+","+i+" 0 "+u+" 1 "+q+","+r+" Z",w=m("path",{id:a,d:v,fill:h});if(w.appendChild(m("title",{text:f})),w.addEventListener("mouseover",function(a){a.target.style.opacity="0.5",g.getElementById(a.target.getAttribute("id")+"-table").style.backgroundColor="#ccc"}),w.addEventListener("mouseout",function(a){a.target.style.opacity="1",g.getElementById(a.target.getAttribute("id")+"-table").style.backgroundColor="transparent"}),e=j,c>10){var x=n(f,t);return k<Math.PI?x.setAttribute("x",s-o(x)):x.setAttribute("x",s),{path:w,wedgeLabel:x}}return{path:w}},h=m("g",{},"pointer-events:none; font-weight:bold;"),i=m("g");return a.forEach(function(a){var c=f(a.id,b,a.perc,a.label+" ("+a.count+")",a.colour||p());i.appendChild(c.path),c.wedgeLabel&&h.appendChild(c.wedgeLabel)}),i.appendChild(m("circle",{cx:b/2,cy:b/2,r:.05*b,fill:"#fff"})),c.appendChild(i),c.appendChild(h),c}var c=function(a,b,c){c=c||[{name:"Requests",field:"count"}];var d=l("div",{"class":"table-holder"}),e=l("table",{cellspacing:"0"},""),f=l("thead"),g=l("tbody");return f.appendChild(l("th",{text:a,"class":"text-left"})),c.forEach(function(a){f.appendChild(l("th",{text:a.name,"class":"text-right"}))}),f.appendChild(l("th",{text:"Percentage","class":"text-right"})),e.appendChild(f),b.forEach(function(a){var b=l("tr",{id:a.id+"-table"});b.appendChild(l("td",{text:a.label})),c.forEach(function(c){b.appendChild(l("td",{text:a[c.field],"class":"text-right"}))}),b.appendChild(l("td",{text:a.perc.toPrecision(2)+"%","class":"text-right"})),g.appendChild(b)}),e.appendChild(g),d.appendChild(e),d},d=b.filter(function(a){return 0===a.name.indexOf("http")&&!a.name.match(/js.map$/)}),e=s(d.map(function(a){return a.initiatorType||a.fileExtension}),"fileType"),f=s(d.map(function(a){return(a.initiatorType||a.fileExtension)+" "+(a.isRequestToHost?"(host)":"(extenal)")}),"fileType"),h=s(d.map(function(a){return a.domain}),"domain");d.forEach(function(a){var b=h.filter(function(b){return b.domain==a.domain})[0]||{};b.durationTotal=(b.durationTotal||0)+a.duration});var j=d.filter(function(a){return a.domain===location.host}).length,q=l("div",{"class":"pie-charts-holder chart-holder"}),t=function(b,e,f,g){var h=l("div",{"class":"pie-chart-holder"});h.appendChild(l("h1",{text:b})),h.appendChild(a(e,400)),h.appendChild(l("p",{text:"Total Requests: "+d.length})),f&&f.length&&f.forEach(function(a){h.appendChild(l("p",{text:a},"margin-top:-1em"))}),h.appendChild(c(b,e,g)),q.appendChild(h)};i.appendChild(q);var u=d.length/100,v="789abcdef",w="789abcdef",x="789abcdef",y=h.map(function(a){return a.perc=a.count/u,a.label=a.domain,a.colour=a.domain===location.host?"#0c0":a.domain.split(".").slice(-2).join(".")===location.host.split(".").slice(-2).join(".")?"#0a0":p("56789abcdef","01234567","abcdef"),a.id="reqByDomain-"+a.label.replace(/[^a-zA-Z]/g,"-"),a.durationAverage=Math.round(a.durationTotal/a.count),a});t("Requests by Domain",y,["Domains Total: "+h.length],[{name:"Requests",field:"count"},{name:"Avg. Duration (ms)",field:"durationAverage"}]),t("Requests by Initiator Type (host/external domain)",f.map(function(a){return a.perc=a.count/u,a.label=a.fileType,a.colour=r(a.fileType.split(" ")[0],p(v,w,x)),a.id="reqByTypeLocEx-"+a.label.replace(/[^a-zA-Z]/g,"-"),a}),["Requests to Host: "+j,"Host: "+location.host]),t("Requests by Initiator Type",e.map(function(a){return a.perc=a.count/u,a.label=a.fileType,a.colour=r(a.fileType,p(v,w,x)),a.id="reqByType-"+a.label.replace(/[^a-zA-Z]/g,"-"),a})),k=k.concat([{name:"Requests by domain",data:h},{name:"File type count (host / external)",data:e,columns:["fileType","count","perc"]},{name:"File type count",data:f,columns:["fileType","count","perc"]}])}),w(function(){var a={pageLoadTime:e.loadEventEnd-e.responseStart,lastResponseEnd:e.loadEventEnd-e.responseStart};for(var d in e)e[d]&&"number"==typeof e[d]&&(a[d]=e[d]-e.navigationStart);var f=function(a,b,c,d){return{name:a,start:b,end:c,total:"number"!=typeof b||"number"!=typeof c?void 0:c-b,colour:d}},g=function(a,b,c,d,e,f){return{name:a,start:b,end:c,total:"number"!=typeof b||"number"!=typeof c?void 0:c-b,colour:d,segments:e,rawResource:f}};a.blocks=[g("Navigation API total",0,a.loadEventEnd,"#ccc",[f("ttfb",a.navigationStart,a.responseStart,"#bbb"),f("unload",a.unloadEventStart,a.unloadEventEnd,"#909"),f("redirect",a.redirectStart,a.redirectEnd,"#009"),f("App cache",a.fetchStart,a.domainLookupStart,"#099"),f("DNS",a.domainLookupStart,a.domainLookupEnd,"#090"),f("TCP",a.connectStart,a.connectEnd,"#990"),f("Request",a.requestStart,a.responseStart,"#c90"),f("Response",a.responseStart,a.responseEnd,"#6c0"),f("DOM Processing",a.domLoading,a.domComplete,"#9cc"),f("domContentLoaded Event",a.domContentLoadedEventStart,a.domContentLoadedEventEnd,"#c33"),f("Onload Event",a.loadEventStart,a.loadEventEnd,"#cf3")])],b.forEach(function(b){var c=[f("redirect",b.redirectStart,b.redirectEnd,"#030"),f("domainLookup",b.domainLookupStart,b.domainLookupEnd,"#060"),f("connect",b.connectStart,b.connectEnd,"#090"),f("secureConnect",b.secureConnectionStart,b.connectEnd,"#0c0"),f("requestToResponseStart",b.requestStart,b.responseStart,"#0f0"),f("response",b.responseStart,b.responseEnd,"#0fc")];a.blocks.push(g(b.name,Math.round(b.startTime),Math.round(b.responseEnd),r(b.initiatorType),c,b)),a.lastResponseEnd=Math.max(a.lastResponseEnd,b.responseEnd)}),a.loadDuration=Math.round(a.lastResponseEnd);var h=function(a,b){var d=a/100,e=b.filter(function(a){return"number"==typeof a.start&&"number"==typeof a.total}).sort(function(a,b){return(a.start||0)-(b.start||0)}),f=c.length>0?c.reduce(function(a,b){return Math.max("number"==typeof a?a:0,o(n(b.name,"0")))}):0,g=25*(e.length+1),h=g+f+35,j=l("div",{"class":"resource-timing water-fall-holder chart-holder"}),k=m("svg:svg",{height:Math.floor(h),"class":"water-fall-chart"}),p=m("g",{"class":"labels"}),q=m("line",{x1:"0",y1:"0",x2:"0",y2:g,"class":"line-end"}),r=m("line",{x1:"0",y1:"0",x2:"0",y2:g,"class":"line-start"}),s=function(a){var b=a.target;u(b,"active");var c=b.x.baseVal.valueInSpecifiedUnits+b.width.baseVal.valueInSpecifiedUnits+"%",d=b.x.baseVal.valueInSpecifiedUnits+"%";q.x1.baseVal.valueAsString=c,q.x2.baseVal.valueAsString=c,r.x1.baseVal.valueAsString=d,r.x2.baseVal.valueAsString=d,u(q,"active"),u(r,"active"),b.parentNode.appendChild(q),b.parentNode.appendChild(r)},t=function(a){v(a.target,"active"),v(q,"active"),v(r,"active")},w=function(a,b,c,e,f,g,h){var i,j=m("rect",{width:a/d+"%",height:b-1,x:c/d+"%",y:e,fill:f,"class":h&&h.length>0?"time-block":"segment"});return g&&j.appendChild(m("title",{text:g})),j.addEventListener("mouseover",s),j.addEventListener("mouseout",t),h&&h.length>0?(i=m("g"),i.appendChild(j),h.forEach(function(a){a.total>0&&a.start&&i.appendChild(w(a.total,8,a.start||.001,e,a.colour,a.name+" ("+Math.round(a.start)+"ms - "+Math.round(a.end)+"ms | total: "+Math.round(a.total)+"ms)"))}),i):j},x=function(){for(var b=m("g",{"class":"time-scale full-width"}),c=0,d=a/1e3,e=100/d;d>=c;c++){var f=n(c+"sec",g);c>d-.2?(f.setAttribute("x",e*c-.5+"%"),f.setAttribute("text-anchor","end")):f.setAttribute("x",e*c+.5+"%");var h=m("line",{x1:e*c+"%",y1:"0",x2:e*c+"%",y2:g});b.appendChild(h),b.appendChild(f)}return b},y=function(){var a=m("g",{transform:"scale(1, 1)","class":"marker-holder"});return c.forEach(function(b,e){var f=m("g",{"class":"mark-holder"}),h=m("g",{"class":"line-holder"}),i=b.startTime/d;b.x=i;var j=n(b.name,g+25);j.setAttribute("writing-mode","tb"),j.setAttribute("x",i+"%"),j.setAttribute("stroke",""),h.appendChild(m("line",{x1:i+"%",y1:0,x2:i+"%",y2:g})),c[e-1]&&b.x-c[e-1].x<1&&(j.setAttribute("x",c[e-1].x+1+"%"),b.x=c[e-1].x+1),h.appendChild(m("line",{x1:i+"%",y1:g,x2:b.x+"%",y2:g+23})),j.addEventListener("mouseover",function(){u(h,"active"),f.parentNode.appendChild(f)}),j.addEventListener("mouseout",function(){v(h,"active")}),f.appendChild(m("title",{text:b.name+" ("+Math.round(b.startTime)+"ms)"})),f.appendChild(h),f.appendChild(j),a.appendChild(f)}),a};k.appendChild(x()),k.appendChild(y()),e.forEach(function(a,b){var c=a.total||1,e=25*b;k.appendChild(w(c,25,a.start||.001,e,a.colour,a.name+" ("+a.start+"ms - "+a.end+"ms | total: "+a.total+"ms)",a.segments));var f=n(" ("+a.total+"ms) "+a.name,e+20);(a.total||1)/d>10&&o(f)<200?(f.setAttribute("class","inner-label"),f.setAttribute("x",(a.start||.001)/d+.5+"%"),f.setAttribute("width",c/d+"%")):(a.start||.001)/d+c/d<80?f.setAttribute("x",(a.start||.001)/d+c/d+.5+"%"):(f.setAttribute("x",(a.start||.001)/d-.5+"%"),f.setAttribute("text-anchor","end")),f.style.opacity=a.name.match(/js.map$/)?"0.5":"1",p.appendChild(f)}),k.appendChild(p),j.appendChild(l("h1",{text:"Resource Timing"})),j.appendChild(k),i.appendChild(j)};h(a.loadDuration,a.blocks)}),w(function(){g.body.appendChild(h),f.style.height=h.clientHeight+"px"}),k.forEach(function(a){a.data.length>0&&console.table&&(console.log("\n\n\n"+a.name+":"),console.table(a.data,a.columns))})}();